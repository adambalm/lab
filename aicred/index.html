<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI CRED Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Source+Sans+3:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: "Source Sans 3", -apple-system, sans-serif; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
const { useState, useEffect } = React;

// =============================================================================
// DATA: Decision History is the spine - everything links to/from it
// =============================================================================

// Patterns are loaded from patterns-data.json (synced from Basic Memory)
// Run: node sync-patterns.js to update

const decisions = [
  {
    id: 'stevens-essay',
    problem: 'Stevens Essay ("The Rage We Forgot to Name")',
    status: 'abandoned',
    date: '2025-12-28',
    reason: 'Not recurring ‚Äî literary close reading is one-off, can\'t measure across approaches',
    lesson: 'Module 4 needs problems that recur and can be measured',
    patternsConsidered: ['skill-forge'],
    module: 4
  },
  {
    id: 'skill-forge-stevens',
    problem: 'Skill Forge Pattern on Stevens Essay',
    status: 'rejected',
    date: '2025-12-28',
    reason: 'Fails overengineering test ‚Äî no recurring problem class to amortize deliberation cost',
    lesson: 'Skill Forge requires problems likely to recur; one-off essays don\'t qualify',
    patternsConsidered: ['skill-forge'],
    module: 4
  },
  {
    id: 'jsx-gitpages',
    problem: 'JSX ‚Üí GitPages Publishing',
    status: 'completed',
    date: '2025-12-28',
    reason: 'Recurs (every artifact), measurable (deploy success Y/N), current process unsatisfying',
    lesson: 'The conversion is a prompt problem. The deployment is not.',
    patternsUsed: ['systematic-iteration'],
    heuristicsProduced: [
      'Single prompt when deterministic + all context in input',
      'Compound workflow when success depends on external context',
      'Novel pattern when 10+ uses justify infrastructure',
      'Don\'t use prompts for running commands ‚Äî not a prompt problem'
    ],
    module: 4
  },
  {
    id: 'memento-classifier',
    problem: 'Memento Tab Classifier (26% ‚Üí 100%)',
    status: 'completed',
    date: '2025-12-24',
    reason: 'Tab capture incomplete ‚Äî needed structured output to force exhaustive enumeration',
    lesson: 'Structural constraints beat verbal emphasis. Make output format require explicit enumeration.',
    patternsUsed: ['systematic-iteration', 'selective-deep-dive'],
    module: 2
  }
];

// Patterns will be loaded from patterns-data.json via useEffect in AICREDDashboard
// This fallback is used if fetch fails
const fallbackPatterns = [
  {
    id: 'selective-deep-dive',
    name: 'Selective Deep Dive Pattern',
    type: 'prompt',
    status: 'stable',
    description: 'Two-pass: classify + triage ‚Üí conditional deep analysis with hints',
    kbPath: 'patterns/prompt-patterns/Selective Deep Dive Pattern.md',
    problemSignature: ['Collection processing with mixed-depth items'],
    templateSummary: 'Pass 1: Classify and flag. Pass 2: Deep analysis on flagged items.',
    gotchas: ['Hint quality matters', 'Pass 1 must be conservative'],
    antiPatterns: ['All items need same depth', 'Single item processing'],
    relatedPatterns: ['systematic-iteration'],
    example: 'Memento browser session classifier'
  }
];

// AI Fluency Score from aicred.ai (manually updated after assessments)
const fluencyScore = {
  current: 9.1,
  previous: 7.6,
  tier: 'HIGH VELOCITY',
  lastUpdated: '2025-12-29',
  evaluations: 1,
  components: {
    promptMastery: 8.2,
    technicalUnderstanding: 8.5,
    practicalApplication: 8.4,
    criticalEvaluation: 8.8,
    workflowDesign: 8.6
  },
  // Map components to dashboard work for "living story" connection
  componentConnections: {
    promptMastery: 'Pattern library depth, prompt refinement (Systematic Iteration Protocol)',
    technicalUnderstanding: 'Understanding model behavior, structural constraints beat verbal emphasis',
    practicalApplication: 'Problems solved: Memento classifier, JSX conversion',
    criticalEvaluation: 'Module 5 pattern audit, health metrics, deprecation decisions',
    workflowDesign: 'Compound workflows, Selective Deep Dive, pass1Guidance refactor'
  }
};

// Pattern health metrics for Module 5 audit (separate concern)
const patternHealthMetrics = {
  'selective-deep-dive': { lastUsed: '2025-12-28', monthlyUsesActual: 4, monthlyUsesExpected: 5, cognitiveLoad: 'medium', maintenanceBurden: 2 },
  'systematic-iteration': { lastUsed: '2025-12-24', monthlyUsesActual: 6, monthlyUsesExpected: 8, cognitiveLoad: 'medium', maintenanceBurden: 3 },
  'adversarial-review': { lastUsed: '2025-12-20', monthlyUsesActual: 2, monthlyUsesExpected: 4, cognitiveLoad: 'high', maintenanceBurden: 4 },
  'cross-examination': { lastUsed: '2025-12-16', monthlyUsesActual: 1, monthlyUsesExpected: 3, cognitiveLoad: 'high', maintenanceBurden: 5 },
  'skill-forge': { lastUsed: '2025-12-28', monthlyUsesActual: 0, monthlyUsesExpected: 2, cognitiveLoad: 'high', maintenanceBurden: 6 },
  'canonical-overlays': { lastUsed: '2025-12-14', monthlyUsesActual: 3, monthlyUsesExpected: 3, cognitiveLoad: 'low', maintenanceBurden: 2 }
};

const modules = [
  { id: 1, name: 'Your Prompt Pattern Library', status: 'completed' },
  { id: 2, name: 'Systematic Prompt Refinement Through Controlled Iteration', status: 'completed' },
  { id: 3, name: 'Pattern Orchestration: Composing Multi-Step Workflows', status: 'completed' },
  { id: 4, name: 'Pattern Selection: Single vs. Compound Workflows', status: 'completed' },
  { id: 5, name: 'Pattern Library Health: When to Refactor, Retire, or Rebuild', status: 'completed' },
];

const evidenceLog = [
  { date: '2025-12-24', work: 'Systematic Prompt Iteration Protocol documented', module: 2, decisionId: 'memento-classifier' },
  { date: '2025-12-24', work: 'Memento classifier: 26% ‚Üí 100% via structural constraint', module: 2, decisionId: 'memento-classifier' },
  { date: '2025-12-24', work: 'Selective Deep Dive Pattern documented', module: 3 },
  { date: '2025-12-25', work: 'Module 3 Progress Check completed', module: 3 },
  { date: '2025-12-28', work: 'Three-Approach Test completed (JSX ‚Üí HTML)', module: 4, decisionId: 'jsx-gitpages' },
  { date: '2025-12-28', work: 'Decision Framework: 4 heuristics documented', module: 4, decisionId: 'jsx-gitpages' },
  { date: '2025-12-28', work: 'Module 4 Progress Check taken', module: 4 },
  { date: '2025-12-29', work: 'Pattern Health Audit: usage metrics, cognitive load assessment', module: 5 },
  { date: '2025-12-29', work: 'Identified Selective Deep Dive as refactor candidate (pass1Guidance generalization)', module: 5 },
  { date: '2025-12-29', work: 'Module 5 Progress Check completed', module: 5 },
];

const problemFirstNav = [
  { problem: 'I have many items and some need more analysis than others', patternId: 'selective-deep-dive', decisionId: 'memento-classifier' },
  { problem: 'My prompt works inconsistently and I don\'t know why', patternId: 'systematic-iteration', decisionId: 'memento-classifier' },
  { problem: 'I need to validate an artifact against requirements', patternId: 'adversarial-review', decisionId: null },
  { problem: 'I need to stress-test an idea before building anything', patternId: 'cross-examination', decisionId: null },
  { problem: 'I have a novel problem requiring qualified human judgment', patternId: 'skill-forge', decisionId: 'skill-forge-stevens' },
  { problem: 'I need variations without drift or maintenance multiplication', patternId: 'canonical-overlays', decisionId: null }
];

// =============================================================================
// COLORS
// =============================================================================
const colors = {
  bg: '#0a0a0c', surface: '#141418', surfaceHover: '#1c1c22',
  border: '#2a2a32', borderLight: '#3a3a44',
  text: '#e8e8ec', textMuted: '#8888a0', textDim: '#5a5a6a',
  accent: '#60a5fa', accentDim: '#2563eb',
  success: '#4ade80', successDim: '#166534',
  warning: '#fbbf24', warningDim: '#854d0e',
  danger: '#f87171', dangerDim: '#991b1b',
  purple: '#a78bfa', purpleDim: '#5b21b6',
};

// =============================================================================
// COMPONENTS
// =============================================================================

function Badge({ status, children }) {
  const styles = {
    completed: { bg: colors.successDim, color: colors.success },
    active: { bg: colors.accentDim, color: colors.accent },
    stable: { bg: colors.successDim, color: colors.success },
    draft: { bg: colors.warningDim, color: colors.warning },
    abandoned: { bg: colors.warningDim, color: colors.warning },
    rejected: { bg: colors.dangerDim, color: colors.danger },
    pending: { bg: colors.border, color: colors.textMuted },
    low: { bg: colors.successDim, color: colors.success },
    medium: { bg: colors.warningDim, color: colors.warning },
    high: { bg: colors.dangerDim, color: colors.danger },
    prompt: { bg: colors.accentDim, color: colors.accent },
    workflow: { bg: colors.successDim, color: colors.success },
    architectural: { bg: colors.purpleDim, color: colors.purple },
  };
  const s = styles[status] || styles.pending;
  return (
    <span style={{ display: 'inline-flex', alignItems: 'center', padding: '3px 8px', borderRadius: 4, fontSize: 11, fontWeight: 600, background: s.bg, color: s.color, textTransform: 'uppercase', letterSpacing: '0.02em' }}>
      {children || status}
    </span>
  );
}

function Card({ title, children, style }) {
  return (
    <div style={{ background: colors.surface, border: `1px solid ${colors.border}`, borderRadius: 8, padding: 20, ...style }}>
      {title && <h3 style={{ margin: '0 0 16px 0', fontSize: 13, fontWeight: 600, color: colors.textMuted, textTransform: 'uppercase', letterSpacing: '0.05em' }}>{title}</h3>}
      {children}
    </div>
  );
}

function Tabs({ tabs, active, onChange }) {
  return (
    <div style={{ display: 'flex', gap: 2, marginBottom: 20, borderBottom: `1px solid ${colors.border}`, paddingBottom: 1, flexWrap: 'wrap' }}>
      {tabs.map(t => (
        <button key={t.id} onClick={() => onChange(t.id)} style={{
          background: active === t.id ? colors.surfaceHover : 'transparent',
          border: 'none', borderBottom: active === t.id ? `2px solid ${colors.accent}` : '2px solid transparent',
          padding: '10px 16px', color: active === t.id ? colors.text : colors.textMuted, cursor: 'pointer',
          fontSize: 13, fontWeight: 500, marginBottom: -2
        }}>
          {t.label}
        </button>
      ))}
    </div>
  );
}

function ScoreRing({ score, target, size = 120 }) {
  const stroke = 8, radius = (size - stroke) / 2, circumference = 2 * Math.PI * radius;
  const progress = (score / 10) * circumference, targetProgress = (target / 10) * circumference;
  return (
    <div style={{ position: 'relative', width: size, height: size }}>
      <svg width={size} height={size} style={{ transform: 'rotate(-90deg)' }}>
        <circle cx={size/2} cy={size/2} r={radius} fill="none" stroke={colors.border} strokeWidth={stroke} />
        <circle cx={size/2} cy={size/2} r={radius} fill="none" stroke={colors.borderLight} strokeWidth={stroke} strokeDasharray={circumference} strokeDashoffset={circumference - targetProgress} strokeLinecap="round" opacity={0.4} />
        <circle cx={size/2} cy={size/2} r={radius} fill="none" stroke={colors.accent} strokeWidth={stroke} strokeDasharray={circumference} strokeDashoffset={circumference - progress} strokeLinecap="round" />
      </svg>
      <div style={{ position: 'absolute', top: 0, left: 0, right: 0, bottom: 0, display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center' }}>
        <span style={{ fontSize: 28, fontWeight: 700, color: colors.text, fontFamily: 'JetBrains Mono' }}>{score.toFixed(1)}</span>
        <span style={{ fontSize: 11, color: colors.textMuted }}>/ {target}</span>
      </div>
    </div>
  );
}

// Decision Card with links to patterns
function DecisionCard({ decision, onPatternClick, patterns = [] }) {
  const statusColor = { completed: colors.success, abandoned: colors.warning, rejected: colors.danger }[decision.status];
  const patternsInvolved = [...(decision.patternsConsidered || []), ...(decision.patternsUsed || [])];

  return (
    <div style={{ padding: 16, background: colors.surfaceHover, border: `1px solid ${colors.border}`, borderRadius: 8, borderLeft: `4px solid ${statusColor}`, marginBottom: 12 }}>
      <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: 8 }}>
        <h4 style={{ margin: 0, fontSize: 15, fontWeight: 600, color: colors.text }}>{decision.problem}</h4>
        <div style={{ display: 'flex', gap: 8, alignItems: 'center' }}>
          <span style={{ fontSize: 11, color: colors.textDim, fontFamily: 'JetBrains Mono' }}>{decision.date}</span>
          <Badge status={decision.status}>{decision.status}</Badge>
        </div>
      </div>
      <p style={{ margin: '0 0 8px 0', fontSize: 13, color: colors.textMuted }}><strong style={{ color: colors.text }}>Reason:</strong> {decision.reason}</p>
      <div style={{ padding: '8px 12px', background: colors.accentDim, borderRadius: 4, marginBottom: 8 }}>
        <span style={{ fontSize: 12, color: colors.accent, fontStyle: 'italic' }}>Lesson: {decision.lesson}</span>
      </div>
      {patternsInvolved.length > 0 && (
        <div style={{ display: 'flex', gap: 8, alignItems: 'center', flexWrap: 'wrap' }}>
          <span style={{ fontSize: 11, color: colors.textDim }}>Patterns:</span>
          {patternsInvolved.map(pId => {
            const p = patterns.find(x => x.id === pId);
            return p ? (
              <button key={pId} onClick={() => onPatternClick(pId)} style={{ background: colors.border, border: 'none', padding: '4px 8px', borderRadius: 4, fontSize: 11, color: colors.accent, cursor: 'pointer' }}>
                ‚Üí {p.name}
              </button>
            ) : null;
          })}
        </div>
      )}
      {decision.heuristicsProduced && (
        <div style={{ marginTop: 12, paddingTop: 12, borderTop: `1px solid ${colors.border}` }}>
          <span style={{ fontSize: 11, color: colors.textDim, display: 'block', marginBottom: 8 }}>Produced heuristics:</span>
          {decision.heuristicsProduced.map((h, i) => (
            <div key={i} style={{ display: 'flex', gap: 8, alignItems: 'flex-start', marginBottom: 4 }}>
              <span style={{ width: 18, height: 18, borderRadius: '50%', background: colors.accentDim, color: colors.accent, fontSize: 10, fontWeight: 600, display: 'flex', alignItems: 'center', justifyContent: 'center', flexShrink: 0 }}>{i+1}</span>
              <span style={{ fontSize: 12, color: colors.text }}>{h}</span>
            </div>
          ))}
        </div>
      )}
    </div>
  );
}

// Expandable Pattern Card
function PatternCard({ pattern, expanded, onToggle, onDecisionClick }) {
  const typeColors = { prompt: colors.accent, workflow: colors.success, architectural: colors.purple };
  const decisionsUsingThis = decisions.filter(d => (d.patternsUsed || []).includes(pattern.id) || (d.patternsConsidered || []).includes(pattern.id));

  return (
    <div id={`pattern-${pattern.id}`} style={{ background: colors.surfaceHover, border: `1px solid ${colors.border}`, borderRadius: 8, borderLeft: `4px solid ${typeColors[pattern.type]}`, marginBottom: 16 }}>
      {/* Collapsed View */}
      <div style={{ padding: 16 }}>
        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: 8 }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>
            <span style={{ fontSize: 15, fontWeight: 600, color: colors.text }}>{pattern.name}</span>
            {pattern.meta && <span style={{ fontSize: 10, padding: '2px 6px', background: colors.warningDim, color: colors.warning, borderRadius: 3 }}>META</span>}
          </div>
          <div style={{ display: 'flex', gap: 8 }}>
            <Badge status={pattern.type}>{pattern.type}</Badge>
            <Badge status={pattern.status}>{pattern.status}</Badge>
          </div>
        </div>
        <p style={{ margin: '0 0 12px 0', fontSize: 13, color: colors.textMuted }}>{pattern.description}</p>

        {/* Problem Signature - Always Visible */}
        <div style={{ marginBottom: 12 }}>
          <span style={{ fontSize: 11, color: colors.textDim, display: 'block', marginBottom: 6 }}>Problem Signature:</span>
          <ul style={{ margin: 0, paddingLeft: 16, fontSize: 13, color: colors.text }}>
            {pattern.problemSignature.slice(0, expanded ? undefined : 3).map((sig, i) => (
              <li key={i} style={{ marginBottom: 4 }}>{sig}</li>
            ))}
            {!expanded && pattern.problemSignature.length > 3 && (
              <li style={{ color: colors.textDim, fontStyle: 'italic' }}>...and {pattern.problemSignature.length - 3} more</li>
            )}
          </ul>
        </div>

        {/* Decision History Link */}
        {decisionsUsingThis.length > 0 && (
          <div style={{ display: 'flex', gap: 8, alignItems: 'center', marginBottom: 12, flexWrap: 'wrap' }}>
            <span style={{ fontSize: 11, color: colors.textDim }}>Used in:</span>
            {decisionsUsingThis.map(d => (
              <button key={d.id} onClick={() => onDecisionClick(d.id)} style={{ background: colors.border, border: 'none', padding: '4px 8px', borderRadius: 4, fontSize: 11, color: colors.accent, cursor: 'pointer' }}>
                {d.problem.slice(0, 30)}{d.problem.length > 30 ? '...' : ''} ({d.status})
              </button>
            ))}
          </div>
        )}

        <button onClick={onToggle} style={{ background: colors.border, border: 'none', padding: '6px 12px', borderRadius: 4, fontSize: 12, color: colors.text, cursor: 'pointer' }}>
          {expanded ? '‚ñ≤ Collapse' : '‚ñº Expand Details'}
        </button>
      </div>

      {/* Expanded View */}
      {expanded && (
        <div style={{ padding: '0 16px 16px 16px', borderTop: `1px solid ${colors.border}` }}>
          {/* Template Summary */}
          <div style={{ marginTop: 16, marginBottom: 16 }}>
            <span style={{ fontSize: 11, color: colors.textDim, display: 'block', marginBottom: 6 }}>Template Summary:</span>
            <p style={{ margin: 0, fontSize: 13, color: colors.text, padding: 12, background: colors.surface, borderRadius: 6 }}>{pattern.templateSummary}</p>
          </div>

          {/* Core Insight if present */}
          {pattern.coreInsight && (
            <div style={{ marginBottom: 16, padding: 12, background: colors.accentDim, borderRadius: 6, borderLeft: `3px solid ${colors.accent}` }}>
              <span style={{ fontSize: 11, color: colors.textDim, display: 'block', marginBottom: 4 }}>Core Insight:</span>
              <p style={{ margin: 0, fontSize: 13, color: colors.text }}>{pattern.coreInsight}</p>
            </div>
          )}

          {/* Gotchas */}
          <div style={{ marginBottom: 16 }}>
            <span style={{ fontSize: 11, color: colors.textDim, display: 'block', marginBottom: 6 }}>‚ö†Ô∏è Gotchas:</span>
            <ul style={{ margin: 0, paddingLeft: 16, fontSize: 12, color: colors.warning }}>
              {pattern.gotchas.map((g, i) => <li key={i} style={{ marginBottom: 4 }}>{g}</li>)}
            </ul>
          </div>

          {/* Anti-Patterns */}
          <div style={{ marginBottom: 16 }}>
            <span style={{ fontSize: 11, color: colors.textDim, display: 'block', marginBottom: 6 }}>‚úó When NOT to Use:</span>
            <ul style={{ margin: 0, paddingLeft: 16, fontSize: 12, color: colors.danger }}>
              {pattern.antiPatterns.map((a, i) => <li key={i} style={{ marginBottom: 4 }}>{a}</li>)}
            </ul>
          </div>

          {/* Related Patterns */}
          {pattern.relatedPatterns.length > 0 && (
            <div style={{ marginBottom: 16 }}>
              <span style={{ fontSize: 11, color: colors.textDim, display: 'block', marginBottom: 6 }}>Related Patterns:</span>
              <div style={{ display: 'flex', gap: 8, flexWrap: 'wrap' }}>
                {pattern.relatedPatterns.map(rpId => {
                  const rp = patterns.find(x => x.id === rpId);
                  return rp ? (
                    <a key={rpId} href={`#pattern-${rpId}`} style={{ background: colors.border, padding: '4px 8px', borderRadius: 4, fontSize: 11, color: colors.accent, textDecoration: 'none' }}>
                      ‚Üí {rp.name}
                    </a>
                  ) : null;
                })}
              </div>
            </div>
          )}

          {/* Example */}
          {pattern.example && (
            <div style={{ marginBottom: 16 }}>
              <span style={{ fontSize: 11, color: colors.textDim, display: 'block', marginBottom: 6 }}>Example:</span>
              <p style={{ margin: 0, fontSize: 13, color: colors.text }}>{pattern.example}</p>
            </div>
          )}

          {/* KB Path */}
          <div style={{ fontSize: 11, color: colors.textDim, fontFamily: 'JetBrains Mono' }}>
            KB: {pattern.kbPath}
          </div>
        </div>
      )}
    </div>
  );
}

// Problem-First Navigator
function ProblemFirstNav({ items, onPatternClick, onDecisionClick, patterns = [] }) {
  const [expanded, setExpanded] = useState({});

  return (
    <Card title="What's Your Situation?" style={{ marginBottom: 20 }}>
      <p style={{ margin: '0 0 16px 0', fontSize: 13, color: colors.textMuted }}>
        Match your problem to a pattern. Each entry shows where the pattern was used (or why it was rejected).
      </p>
      {items.map((item, i) => {
        const pattern = patterns.find(p => p.id === item.patternId);
        const decision = item.decisionId ? decisions.find(d => d.id === item.decisionId) : null;
        const isExpanded = expanded[i];

        return (
          <div key={i} style={{ marginBottom: 8 }}>
            <button onClick={() => setExpanded({...expanded, [i]: !isExpanded})} style={{ width: '100%', textAlign: 'left', background: colors.surface, border: `1px solid ${colors.border}`, borderRadius: 6, padding: 12, cursor: 'pointer' }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>
                <span style={{ color: colors.accent }}>{isExpanded ? '‚ñº' : '‚ñ∏'}</span>
                <span style={{ fontSize: 14, color: colors.text }}>{item.problem}</span>
              </div>
            </button>
            {isExpanded && (
              <div style={{ marginLeft: 24, marginTop: 8, padding: 12, background: colors.surfaceHover, borderRadius: 6 }}>
                <div style={{ marginBottom: 8 }}>
                  <span style={{ fontSize: 12, color: colors.textDim }}>Pattern: </span>
                  <button onClick={() => onPatternClick(item.patternId)} style={{ background: 'none', border: 'none', color: colors.accent, fontSize: 13, cursor: 'pointer', textDecoration: 'underline' }}>
                    {pattern?.name}
                  </button>
                </div>
                <div>
                  <span style={{ fontSize: 12, color: colors.textDim }}>Decision: </span>
                  {decision ? (
                    <button onClick={() => onDecisionClick(item.decisionId)} style={{ background: 'none', border: 'none', color: colors.accent, fontSize: 13, cursor: 'pointer', textDecoration: 'underline' }}>
                      {decision.problem} ({decision.status})
                    </button>
                  ) : (
                    <span style={{ fontSize: 12, color: colors.textMuted, fontStyle: 'italic' }}>No decision history yet</span>
                  )}
                </div>
              </div>
            )}
          </div>
        );
      })}
    </Card>
  );
}

// Resume with Claude
function ResumeWithClaude() {
  return (
    <div style={{ marginTop: 24, padding: 20, background: colors.surface, border: `1px solid ${colors.accentDim}`, borderRadius: 8, display: 'flex', alignItems: 'center', gap: 16 }}>
      <div style={{ fontSize: 32 }}>üí¨</div>
      <div style={{ flex: 1 }}>
        <h4 style={{ margin: '0 0 4px 0', fontSize: 14, fontWeight: 600, color: colors.text }}>Resume with Claude</h4>
        <p style={{ margin: 0, fontSize: 13, color: colors.textMuted }}>
          Say <code style={{ background: colors.bg, padding: '2px 8px', borderRadius: 4, color: colors.accent, fontFamily: 'JetBrains Mono' }}>aicred</code> in Claude Code to load full context and continue.
        </p>
      </div>
      <div style={{ textAlign: 'right', fontSize: 11, color: colors.textDim }}>
        <div>Session Briefing</div>
        <div style={{ fontFamily: 'JetBrains Mono' }}>projects/aicred/</div>
      </div>
    </div>
  );
}

// =============================================================================
// MAIN DASHBOARD
// =============================================================================
function AICREDDashboard() {
  const [activeTab, setActiveTab] = useState('overview');
  const [expandedPatterns, setExpandedPatterns] = useState({});
  const [patterns, setPatterns] = useState(fallbackPatterns);
  const [patternsLoading, setPatternsLoading] = useState(true);

  // Load patterns from patterns-data.json (synced from Basic Memory)
  useEffect(() => {
    fetch('patterns-data.json')
      .then(res => res.json())
      .then(data => {
        if (data.patterns && data.patterns.length > 0) {
          setPatterns(data.patterns);
        }
        setPatternsLoading(false);
      })
      .catch(err => {
        console.warn('Could not load patterns-data.json, using fallback:', err);
        setPatternsLoading(false);
      });
  }, []);

  const tabs = [
    { id: 'overview', label: 'Overview' },
    { id: 'history', label: 'Problem History' },
    { id: 'patterns', label: 'Pattern Library' },
    { id: 'audit', label: 'Pattern Audit' },
    { id: 'evidence', label: 'Evidence Log' },
  ];

  const handlePatternClick = (patternId) => {
    setActiveTab('patterns');
    setExpandedPatterns({ [patternId]: true });
    setTimeout(() => {
      document.getElementById(`pattern-${patternId}`)?.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }, 100);
  };

  const handleDecisionClick = (decisionId) => {
    setActiveTab('history');
    setTimeout(() => {
      document.getElementById(`decision-${decisionId}`)?.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }, 100);
  };

  const activeModule = modules.find(m => m.status === 'active');

  return (
    <div style={{ minHeight: '100vh', background: colors.bg, color: colors.text, fontFamily: '"Source Sans 3", -apple-system, sans-serif', padding: 24 }}>
      {/* Header */}
      <header style={{ marginBottom: 32 }}>
        <div style={{ display: 'flex', alignItems: 'center', gap: 12, marginBottom: 8 }}>
          <h1 style={{ margin: 0, fontSize: 24, fontWeight: 700 }}>AI CRED</h1>
          <Badge status="active">Module {activeModule?.id}</Badge>
        </div>
        <p style={{ margin: 0, color: colors.textMuted, fontSize: 14 }}>{activeModule?.name}</p>
      </header>

      <Tabs tabs={tabs} active={activeTab} onChange={setActiveTab} />

      {/* OVERVIEW TAB */}
      {activeTab === 'overview' && (
        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: 20 }}>
          {/* AI Fluency Score Hero */}
          <Card title="AI Fluency Score" style={{ gridColumn: 'span 2' }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: 32, flexWrap: 'wrap' }}>
              <div style={{ textAlign: 'center' }}>
                <div style={{ fontSize: 56, fontWeight: 700, color: colors.accent }}>{fluencyScore.current}</div>
                <div style={{ fontSize: 11, padding: '4px 12px', background: colors.successDim, color: colors.success, borderRadius: 12, display: 'inline-block', fontWeight: 600 }}>{fluencyScore.tier}</div>
              </div>
              <div style={{ flex: 1, minWidth: 200 }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 12 }}>
                  <span style={{ fontSize: 13, color: colors.textMuted }}>Previous: {fluencyScore.previous}</span>
                  <span style={{ fontSize: 13, padding: '2px 8px', background: colors.successDim, color: colors.success, borderRadius: 8, fontWeight: 600 }}>+{(fluencyScore.current - fluencyScore.previous).toFixed(1)}</span>
                </div>
                <div style={{ fontSize: 12, color: colors.textDim }}>
                  {fluencyScore.evaluations} evaluation{fluencyScore.evaluations !== 1 ? 's' : ''} completed ¬∑ Updated {fluencyScore.lastUpdated}
                </div>
              </div>
            </div>
          </Card>

          {/* Component Breakdown */}
          <Card title="Component Breakdown">
            {Object.entries(fluencyScore.components).map(([key, score]) => {
              const labels = {
                promptMastery: 'Prompt Mastery',
                technicalUnderstanding: 'Technical',
                practicalApplication: 'Practical',
                criticalEvaluation: 'Critical Eval',
                workflowDesign: 'Workflow'
              };
              const pct = (score / 10) * 100;
              return (
                <div key={key} style={{ marginBottom: 12 }} title={fluencyScore.componentConnections[key]}>
                  <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: 12, marginBottom: 4 }}>
                    <span style={{ color: colors.textMuted }}>{labels[key]}</span>
                    <span style={{ fontWeight: 600, color: colors.text }}>{score}</span>
                  </div>
                  <div style={{ height: 6, background: colors.border, borderRadius: 3 }}>
                    <div style={{ height: '100%', width: `${pct}%`, background: score >= 8.5 ? colors.success : score >= 8 ? colors.accent : colors.warning, borderRadius: 3, transition: 'width 0.3s' }} />
                  </div>
                </div>
              );
            })}
            <div style={{ fontSize: 11, color: colors.textDim, marginTop: 12, fontStyle: 'italic' }}>Hover for connection to your work</div>
          </Card>

          {/* Module Progress */}
          <Card title="Module Progress">
            <div style={{ display: 'flex', alignItems: 'center', gap: 16, marginBottom: 16 }}>
              <div style={{ fontSize: 24, fontWeight: 700 }}>{modules.filter(m => m.status === 'completed').length}/{modules.length}</div>
              <div style={{ fontSize: 12, color: colors.textDim }}>modules completed</div>
            </div>
            {modules.map((m, i) => (
              <div key={i} style={{ display: 'flex', alignItems: 'center', gap: 12, padding: '8px 0', borderBottom: i < modules.length - 1 ? `1px solid ${colors.border}` : 'none' }}>
                <span style={{ width: 20, height: 20, borderRadius: '50%', background: m.status === 'completed' ? colors.successDim : m.status === 'active' ? colors.accentDim : colors.border, color: m.status === 'completed' ? colors.success : m.status === 'active' ? colors.accent : colors.textDim, fontSize: 11, fontWeight: 600, display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                  {m.status === 'completed' ? '‚úì' : m.id}
                </span>
                <span style={{ flex: 1, fontSize: 12, color: m.status === 'active' ? colors.text : colors.textMuted }}>{m.name}</span>
              </div>
            ))}
          </Card>

          <Card title="Latest Decision" style={{ gridColumn: 'span 2' }}>
            <DecisionCard decision={decisions.find(d => d.id === 'jsx-gitpages')} onPatternClick={handlePatternClick} patterns={patterns} />
          </Card>

          <ResumeWithClaude />
        </div>
      )}

      {/* PROBLEM HISTORY TAB */}
      {activeTab === 'history' && (
        <div>
          <Card title="Problem Selection Journey">
            <p style={{ margin: '0 0 20px 0', fontSize: 13, color: colors.textMuted }}>
              Module 4 required a problem that recurs, can be measured, and justifies different approaches. Finding the right problem is part of the exercise.
            </p>
            {decisions.filter(d => d.module === 4).map(d => (
              <div key={d.id} id={`decision-${d.id}`}>
                <DecisionCard decision={d} onPatternClick={handlePatternClick} patterns={patterns} />
              </div>
            ))}
          </Card>

          <Card title="Earlier Decisions" style={{ marginTop: 20 }}>
            {decisions.filter(d => d.module !== 4).map(d => (
              <div key={d.id} id={`decision-${d.id}`}>
                <DecisionCard decision={d} onPatternClick={handlePatternClick} patterns={patterns} />
              </div>
            ))}
          </Card>

          <ResumeWithClaude />
        </div>
      )}

      {/* PATTERN LIBRARY TAB */}
      {activeTab === 'patterns' && (
        <div>
          <ProblemFirstNav items={problemFirstNav} onPatternClick={handlePatternClick} onDecisionClick={handleDecisionClick} patterns={patterns} />

          <Card title="Pattern Cards">
            <p style={{ margin: '0 0 16px 0', fontSize: 13, color: colors.textMuted }}>
              Expand any card to see template, gotchas, and when NOT to use. Each card links to decisions where it was used.
            </p>
            {patterns.map(p => (
              <PatternCard
                key={p.id}
                pattern={p}
                expanded={expandedPatterns[p.id]}
                onToggle={() => setExpandedPatterns({ ...expandedPatterns, [p.id]: !expandedPatterns[p.id] })}
                onDecisionClick={handleDecisionClick}
              />
            ))}
          </Card>

          <ResumeWithClaude />
        </div>
      )}

      {/* PATTERN AUDIT TAB (Module 5) */}
      {activeTab === 'audit' && (
        <div>
          <Card title="Pattern Health Metrics (Module 5 Audit)">
            <p style={{ margin: '0 0 16px 0', fontSize: 13, color: colors.textMuted }}>
              Health metrics for evaluating which patterns to keep, refactor, or retire. Patterns with ‚ö† have usage mismatch (actual &lt; expected/2).
            </p>
            <table style={{ width: '100%', borderCollapse: 'collapse', fontSize: 13 }}>
              <thead>
                <tr style={{ borderBottom: `2px solid ${colors.border}` }}>
                  <th style={{ textAlign: 'left', padding: 8, color: colors.textMuted }}>Pattern</th>
                  <th style={{ textAlign: 'center', padding: 8, color: colors.textMuted }}>Status</th>
                  <th style={{ textAlign: 'center', padding: 8, color: colors.textMuted }}>Last Used</th>
                  <th style={{ textAlign: 'center', padding: 8, color: colors.textMuted }}>Uses/mo</th>
                  <th style={{ textAlign: 'center', padding: 8, color: colors.textMuted }}>Load</th>
                  <th style={{ textAlign: 'center', padding: 8, color: colors.textMuted }}>Burden</th>
                </tr>
              </thead>
              <tbody>
                {patterns.map(p => {
                  const metrics = patternHealthMetrics[p.id] || {};
                  const mismatch = metrics.monthlyUsesActual < metrics.monthlyUsesExpected / 2;
                  return (
                    <tr key={p.id} style={{ borderBottom: `1px solid ${colors.border}` }}>
                      <td style={{ padding: 8, color: colors.text }}>{p.name}</td>
                      <td style={{ padding: 8, textAlign: 'center' }}><Badge status={p.status}>{p.status}</Badge></td>
                      <td style={{ padding: 8, textAlign: 'center', fontFamily: 'JetBrains Mono', fontSize: 11, color: colors.textDim }}>{metrics.lastUsed || '-'}</td>
                      <td style={{ padding: 8, textAlign: 'center', color: mismatch ? colors.warning : colors.text }}>
                        {metrics.monthlyUsesActual || 0}/{metrics.monthlyUsesExpected || 0} {mismatch && '‚ö†'}
                      </td>
                      <td style={{ padding: 8, textAlign: 'center' }}><Badge status={metrics.cognitiveLoad || 'medium'}>{metrics.cognitiveLoad || '-'}</Badge></td>
                      <td style={{ padding: 8, textAlign: 'center', color: (metrics.maintenanceBurden || 0) > 4 ? colors.warning : colors.text }}>{metrics.maintenanceBurden || '-'}</td>
                    </tr>
                  );
                })}
              </tbody>
            </table>
          </Card>

          <Card title="Module 5 Exercise Phases" style={{ marginTop: 20 }}>
            {[
              { name: 'Pattern Inventory and Usage Measurement', time: '10 min', desc: 'List patterns, measure actual vs expected usage' },
              { name: 'Cognitive Load Measurement', time: '10 min', desc: 'Score each: Low/Medium/High' },
              { name: 'Maintenance Burden Analysis', time: '10 min', desc: '(Failures√ó2) + Mods + (Deps√ó3) + Fix time' },
              { name: 'Pattern Triage', time: '10 min', desc: 'Create merge, deprecate, refactor lists' },
              { name: 'Lifecycle Policy', time: '5 min', desc: 'Write promotion and retirement rules' },
            ].map((phase, i) => (
              <div key={i} style={{ padding: 12, background: colors.surfaceHover, borderRadius: 6, marginBottom: 8 }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 4 }}>
                  <span style={{ fontSize: 13, fontWeight: 600, color: colors.text }}>Phase {i+1}: {phase.name}</span>
                  <span style={{ fontSize: 11, color: colors.textDim }}>{phase.time}</span>
                </div>
                <p style={{ margin: 0, fontSize: 12, color: colors.textMuted }}>{phase.desc}</p>
              </div>
            ))}
          </Card>

          <ResumeWithClaude />
        </div>
      )}

      {/* EVIDENCE LOG TAB */}
      {activeTab === 'evidence' && (
        <div>
          <Card title="Evidence Log (for Progress Checks)">
            <table style={{ width: '100%', borderCollapse: 'collapse', fontSize: 13 }}>
              <thead>
                <tr style={{ borderBottom: `2px solid ${colors.border}` }}>
                  <th style={{ textAlign: 'left', padding: 8, color: colors.textMuted }}>Date</th>
                  <th style={{ textAlign: 'left', padding: 8, color: colors.textMuted }}>Work Done</th>
                  <th style={{ textAlign: 'center', padding: 8, color: colors.textMuted }}>Module</th>
                  <th style={{ textAlign: 'center', padding: 8, color: colors.textMuted }}>Decision</th>
                </tr>
              </thead>
              <tbody>
                {evidenceLog.slice().reverse().map((e, i) => (
                  <tr key={i} style={{ borderBottom: `1px solid ${colors.border}` }}>
                    <td style={{ padding: 8, fontFamily: 'JetBrains Mono', fontSize: 11, color: colors.textDim }}>{e.date}</td>
                    <td style={{ padding: 8, color: colors.text }}>{e.work}</td>
                    <td style={{ padding: 8, textAlign: 'center' }}>
                      <span style={{ width: 20, height: 20, borderRadius: '50%', background: colors.accentDim, color: colors.accent, fontSize: 11, fontWeight: 600, display: 'inline-flex', alignItems: 'center', justifyContent: 'center' }}>{e.module}</span>
                    </td>
                    <td style={{ padding: 8, textAlign: 'center' }}>
                      {e.decisionId ? (
                        <button onClick={() => handleDecisionClick(e.decisionId)} style={{ background: 'none', border: 'none', color: colors.accent, fontSize: 11, cursor: 'pointer', textDecoration: 'underline' }}>
                          View ‚Üí
                        </button>
                      ) : '-'}
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </Card>

          <ResumeWithClaude />
        </div>
      )}

      <footer style={{ marginTop: 32, textAlign: 'center', fontSize: 12, color: colors.textDim }}>
        ¬© 2025 <a href="https://linkedin.com/in/ed-o-connell-4b38483" target="_blank" rel="noopener" style={{ color: colors.accent, textDecoration: 'none' }}>Ed O'Connell</a>
      </footer>
    </div>
  );
}

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<AICREDDashboard />);
  </script>
</body>
</html>
